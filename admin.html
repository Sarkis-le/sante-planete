<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Administration ‚Äì Sant√© Plan√®te</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg-page: #020617;
      --bg-card: #020617;
      --bg-card-soft: #020617;
      --accent: #22c55e;
      --accent-soft: rgba(34, 197, 94, 0.15);
      --border-subtle: #1e293b;
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --danger: #f97373;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top left, #0f172a, #020617 55%);
      color: var(--text-main);
    }

    a {
      color: var(--accent);
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    .page {
      max-width: 1100px;
      margin: 0 auto;
      padding: 24px 16px 40px;
    }

    .header {
      padding: 16px 0 24px;
      border-bottom: 1px solid #111827;
      margin-bottom: 24px;
    }

    .title {
      font-size: 1.8rem;
      font-weight: 700;
      letter-spacing: 0.03em;
    }

    .subtitle {
      margin-top: 4px;
      color: var(--text-muted);
      max-width: 640px;
      font-size: 0.9rem;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(34, 197, 94, 0.1);
      color: var(--accent);
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-bottom: 10px;
    }

    .badge-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent);
    }

    .card-grid {
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 1.5fr);
      gap: 20px;
    }

    @media (max-width: 900px) {
      .card-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: radial-gradient(circle at top right, #111827, #020617 55%);
      border-radius: 18px;
      padding: 18px 18px 20px;
      border: 1px solid var(--border-subtle);
      box-shadow: 0 18px 35px rgba(15, 23, 42, 0.65);
    }

    .card h2 {
      font-size: 1.05rem;
      margin: 0 0 8px;
    }

    .card p.desc {
      margin: 0 0 12px;
      color: var(--text-muted);
      font-size: 0.86rem;
    }

    .top-link {
      margin-top: 8px;
      font-size: 0.85rem;
    }

    .table-toolbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .table-toolbar-title {
      font-weight: 600;
      font-size: 0.98rem;
    }

    .btn-primary {
      border: none;
      border-radius: 999px;
      padding: 7px 16px;
      font-size: 0.86rem;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #022c22;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.08s ease, box-shadow 0.12s ease,
        filter 0.12s ease;
      box-shadow: 0 12px 25px rgba(22, 163, 74, 0.45);
      white-space: nowrap;
    }

    .btn-primary span.icon {
      font-size: 1rem;
    }

    .btn-primary:hover {
      filter: brightness(1.05);
      transform: translateY(-1px);
      box-shadow: 0 16px 32px rgba(22, 163, 74, 0.55);
    }

    .article-list {
      border-radius: 12px;
      border: 1px solid var(--border-subtle);
      background: rgba(15, 23, 42, 0.9);
      max-height: 430px;
      overflow: auto;
    }

    .empty {
      padding: 16px;
      font-size: 0.86rem;
      color: var(--text-muted);
      text-align: center;
    }

    .article-header-row {
      display: grid;
      grid-template-columns: 60px minmax(0, 2.3fr) minmax(0, 1.6fr) 130px;
      gap: 10px;
      padding: 8px 12px;
      border-bottom: 1px solid #111827;
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #6b7280;
      background: rgba(15, 23, 42, 0.8);
      position: sticky;
      top: 0;
      z-index: 1;
    }

    @media (max-width: 800px) {
      .article-header-row {
        display: none;
      }
    }

    .article-item {
      padding: 10px 12px;
      border-bottom: 1px solid #111827;
      font-size: 0.86rem;
      display: grid;
      grid-template-columns: 60px minmax(0, 2.3fr) minmax(0, 1.6fr) 130px;
      gap: 10px;
      align-items: center;
    }

    .article-item:last-child {
      border-bottom: none;
    }

    @media (max-width: 800px) {
      .article-item {
        grid-template-columns: 60px minmax(0, 1fr);
        grid-template-rows: auto auto auto;
      }
    }

    .thumb-mini {
      width: 100%;
      height: 46px;
      border-radius: 8px;
      object-fit: cover;
      background: #020617;
    }

    .thumb-mini.placeholder {
      border: 1px dashed #1f2937;
      font-size: 0.7rem;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #4b5563;
    }

    .article-item-title {
      font-weight: 600;
      line-height: 1.3;
    }

    .article-item-meta {
      font-size: 0.78rem;
      color: var(--text-muted);
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      border-radius: 999px;
      padding: 2px 8px;
      border: 1px solid #1f2937;
      background: #020617;
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .chip strong {
      color: var(--accent);
      margin-right: 4px;
    }

    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      justify-content: flex-end;
    }

    .btn-sm {
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: #020617;
      color: var(--text-main);
      font-size: 0.75rem;
      padding: 4px 10px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .btn-sm.edit {
      border-color: #4ade80;
      color: #bbf7d0;
    }

    .btn-sm.delete {
      border-color: #fecaca;
      color: #fecaca;
    }

    .btn-sm:hover {
      background: #020617;
      filter: brightness(1.05);
    }

    .count-label {
      color: var(--text-muted);
      font-size: 0.8rem;
    }

    .info-list {
      margin-top: 8px;
      padding-left: 16px;
      color: var(--text-muted);
      font-size: 0.85rem;
    }

    /* Modal */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.8), rgba(2, 6, 23, 0.9));
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal-backdrop.active {
      display: flex;
    }

    .modal {
      width: 100%;
      max-width: 620px;
      background: radial-gradient(circle at top right, #111827, #020617 60%);
      border-radius: 20px;
      border: 1px solid var(--border-subtle);
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.75);
      padding: 18px 18px 20px;
      position: relative;
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 8px;
    }

    .modal-title {
      font-size: 1rem;
      font-weight: 600;
    }

    .modal-close {
      border: none;
      background: transparent;
      color: var(--text-muted);
      font-size: 1.4rem;
      cursor: pointer;
      line-height: 1;
      padding: 2px 6px;
      border-radius: 999px;
    }

    .modal-close:hover {
      background: #0b1120;
      color: #f9fafb;
    }

    .hint {
      font-size: 0.78rem;
      color: var(--text-muted);
      margin-top: 2px;
    }

    label {
      font-size: 0.88rem;
      color: var(--text-muted);
      margin-bottom: 2px;
      display: block;
    }

    input[type="text"],
    textarea,
    select,
    input[type="file"] {
      width: 100%;
      border-radius: 10px;
      border: 1px solid var(--border-subtle);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-main);
      padding: 8px 10px;
      font-size: 0.94rem;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease,
        background 0.15s ease;
    }

    input[type="text"]:focus,
    textarea:focus,
    select:focus,
    input[type="file"]:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.35);
      background: #020617;
    }

    textarea {
      min-height: 120px;
      resize: vertical;
      line-height: 1.5;
    }

    .row {
      display: flex;
      gap: 10px;
    }

    .row > div {
      flex: 1;
    }

    @media (max-width: 640px) {
      .row {
        flex-direction: column;
      }
    }

    .form-grid {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 6px;
    }

    .modal-actions {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-top: 12px;
      flex-wrap: wrap;
    }

    .btn-secondary {
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: #020617;
      color: var(--text-muted);
      font-size: 0.78rem;
      padding: 6px 12px;
      cursor: pointer;
    }

    .btn-secondary:hover {
      background: #020617;
      filter: brightness(1.05);
    }

    #message {
      font-size: 0.85rem;
      min-height: 1.1em;
      margin-top: 4px;
    }

    #message.ok {
      color: #4ade80;
    }

    #message.err {
      color: #fca5a5;
    }
  </style>
</head>

<body>
  <div class="page">
    <header class="header">
      <div class="badge">
        <span class="badge-dot"></span>
        Sant√© Plan√®te ‚Äî Administration
      </div>
      <div class="title">Administration ‚Äì Sant√© Plan√®te</div>
      <p class="subtitle">
        G√©rez ici les articles de conseils sant√© et d‚Äôactualit√©s publi√©s sur Sant√© Plan√®te.
      </p>
      <div class="top-link">
        ‚Üê <a href="/">Retour au site public</a>
      </div>
    </header>

    <main class="card-grid">
      <!-- Colonne gauche : liste des articles -->
      <section class="card">
        <div class="table-toolbar">
          <div class="table-toolbar-title">
            Articles publi√©s
          </div>
          <div style="display:flex;align-items:center;gap:10px;">
            <span id="articles-count" class="count-label"></span>
            <button type="button" class="btn-primary" id="openCreateBtn">
              <span class="icon">Ôºã</span> Nouvel article
            </button>
          </div>
        </div>
        <p class="desc">
          Retrouvez ici tous les articles enregistr√©s dans la base, avec la possibilit√©
          de les modifier ou de les supprimer.
        </p>

        <div class="article-list" id="articles-list">
          <div class="empty">Chargement des articles‚Ä¶</div>
        </div>
      </section>

      <!-- Colonne droite : infos -->
      <section class="card">
        <h2>Infos pratiques</h2>
        <p class="desc">
          Les modifications sont imm√©diatement prises en compte sur le site public
          d√®s que l‚Äôenregistrement a r√©ussi.
        </p>
        <ul class="info-list">
          <li><strong>Slug</strong> : utilis√© pour l‚ÄôURL de l‚Äôarticle, √©vitez les espaces.</li>
          <li><strong>Cat√©gorie</strong> : choisie dans la liste (Sant√©, Nutrition, etc.).</li>
          <li><strong>Image</strong> : vous pouvez choisir une image depuis votre ordinateur ; elle sera stock√©e dans la base.</li>
          <li>Vous pouvez revenir modifier un article ult√©rieurement sans le recr√©er.</li>
        </ul>
      </section>
    </main>
  </div>

  <!-- Modal cr√©ation / √©dition -->
  <div class="modal-backdrop" id="articleModal" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modal-header">
        <div class="modal-title" id="modalTitle">Nouvel article</div>
        <button type="button" class="modal-close" id="modalCloseBtn" aria-label="Fermer">
          √ó
        </button>
      </div>
      <p class="desc" id="modalSubtitle">
        Renseignez le titre, le slug (URL), la cat√©gorie, une image illustrative,
        un √©ventuel r√©sum√© et le contenu d√©taill√© de l‚Äôarticle.
      </p>

      <form id="article-form" autocomplete="off">
        <div class="form-grid">
          <div>
            <label for="title">Titre de l‚Äôarticle *</label>
            <input id="title" name="title" type="text" required />
          </div>

          <div class="row">
            <div>
              <label for="slug">Slug (URL) *</label>
              <input
                id="slug"
                name="slug"
                type="text"
                placeholder="ex : sommeil-reparateur"
                required
              />
              <div class="hint">
                Utilisez uniquement des lettres, chiffres et tirets
                <code>-</code>.
              </div>
            </div>
            <div>
              <label for="category">Cat√©gorie</label>
              <select id="category" name="category">
                <option value="">‚Äî Choisir une cat√©gorie ‚Äî</option>
                <option value="Sant√©">Sant√©</option>
                <option value="Nutrition">Nutrition</option>
                <option value="Psychologie">Psychologie</option>
                <option value="Bien-√™tre">Bien-√™tre</option>
                <option value="Vie quotidienne">Vie quotidienne</option>
              </select>
              <div class="hint">
                Choisissez une cat√©gorie parmi la liste propos√©e.
              </div>
            </div>
          </div>

          <div>
            <label for="imageFile">Image de l‚Äôarticle (depuis votre ordinateur)</label>
            <input
              id="imageFile"
              name="imageFile"
              type="file"
              accept="image/*"
            />
            <div class="hint" id="currentImageHint">
              Aucune image s√©lectionn√©e pour le moment.
            </div>
          </div>

          <div>
            <label for="summary">R√©sum√© (facultatif)</label>
            <textarea
              id="summary"
              name="summary"
              rows="2"
              placeholder="Petite introduction √† l‚Äôarticle‚Ä¶"
            ></textarea>
          </div>

          <div>
            <label for="content">Contenu de l‚Äôarticle *</label>
            <textarea
              id="content"
              name="content"
              rows="7"
              required
              placeholder="R√©digez ici le contenu complet de l‚Äôarticle‚Ä¶"
            ></textarea>
          </div>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn-secondary" id="cancelBtn">Annuler</button>
          <div style="display:flex;flex-direction:column;align-items:flex-end;gap:4px;">
            <button type="submit" class="btn-primary" id="submit-btn">
              Enregistrer l‚Äôarticle
            </button>
            <span class="hint">Les champs marqu√©s d‚Äôune * sont obligatoires.</span>
          </div>
        </div>

        <div id="message" aria-live="polite"></div>
      </form>
    </div>
  </div>

  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script>
    const listContainer   = document.getElementById("articles-list");
    const countLabel      = document.getElementById("articles-count");
    const openCreateBtn   = document.getElementById("openCreateBtn");
    const modalBackdrop   = document.getElementById("articleModal");
    const modalCloseBtn   = document.getElementById("modalCloseBtn");
    const cancelBtn       = document.getElementById("cancelBtn");
    const modalTitle      = document.getElementById("modalTitle");
    const articleForm     = document.getElementById("article-form");
    const submitBtn       = document.getElementById("submit-btn");
    const message         = document.getElementById("message");
    const imageFileInput  = document.getElementById("imageFile");
    const currentImageHint = document.getElementById("currentImageHint");

    let ARTICLES = [];
    let currentMode = "create"; // "create" | "edit"
    let currentId = null;
    let currentImageUrl = "";   // stocke l'image actuelle (URL ou dataURL) en mode √©dition

    function openModal(mode = "create", article = null) {
      currentMode = mode;
      currentId = article && article.id != null ? article.id : null;

      if (mode === "create") {
        modalTitle.textContent = "Nouvel article";
        submitBtn.textContent  = "Publier l‚Äôarticle";
        articleForm.reset();
        currentImageUrl = "";
        currentImageHint.textContent = "Aucune image s√©lectionn√©e pour le moment.";
      } else {
        modalTitle.textContent = "Modifier l‚Äôarticle";
        submitBtn.textContent  = "Enregistrer les modifications";

        articleForm.title.value    = article.title    || "";
        articleForm.slug.value     = article.slug     || "";
        articleForm.summary.value  = article.summary  || "";
        articleForm.content.value  = article.content  || "";

        const catSelect  = articleForm.category;
        const currentCat = article.category || "";

        if (
          currentCat &&
          ![...catSelect.options].some(opt => opt.value === currentCat)
        ) {
          const opt = document.createElement("option");
          opt.value = currentCat;
          opt.textContent = currentCat;
          catSelect.appendChild(opt);
        }
        catSelect.value = currentCat;

        currentImageUrl = article.imageUrl || "";
        if (currentImageUrl) {
          currentImageHint.textContent = "Une image est d√©j√† associ√©e √† cet article. Vous pouvez en choisir une nouvelle pour la remplacer.";
        } else {
          currentImageHint.textContent = "Aucune image enregistr√©e pour cet article. Vous pouvez en s√©lectionner une.";
        }

        imageFileInput.value = "";
      }

      message.textContent = "";
      message.className   = "";

      modalBackdrop.classList.add("active");
      modalBackdrop.setAttribute("aria-hidden", "false");
      setTimeout(() => {
        articleForm.title.focus();
      }, 10);
    }

    function closeModal() {
      modalBackdrop.classList.remove("active");
      modalBackdrop.setAttribute("aria-hidden", "true");
      currentId = null;
      currentMode = "create";
      currentImageUrl = "";
    }

    openCreateBtn.addEventListener("click", () => openModal("create"));
    modalCloseBtn.addEventListener("click", closeModal);
    cancelBtn.addEventListener("click", closeModal);

    modalBackdrop.addEventListener("click", (e) => {
      if (e.target === modalBackdrop) {
        closeModal();
      }
    });

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && modalBackdrop.classList.contains("active")) {
        closeModal();
      }
    });

    async function loadArticles() {
      try {
        const res = await fetch("/api/articles");
        if (!res.ok) throw new Error("Erreur HTTP");
        const articles = await res.json();
        ARTICLES = Array.isArray(articles) ? articles : [];

        renderArticles();
      } catch (err) {
        console.error(err);
        listContainer.innerHTML =
          '<div class="empty">Erreur lors du chargement des articles.</div>';
        countLabel.textContent = "";
      }
    }

    function renderArticles() {
      if (!ARTICLES.length) {
        listContainer.innerHTML =
          '<div class="empty">Aucun article pour le moment.</div>';
        countLabel.textContent = "";
        return;
      }

      countLabel.textContent =
        ARTICLES.length + (ARTICLES.length > 1 ? " articles" : " article");

      listContainer.innerHTML = "";

      const header = document.createElement("div");
      header.className = "article-header-row";
      header.innerHTML = `
        <div>Image</div>
        <div>Titre</div>
        <div>Slug / Cat√©gorie</div>
        <div style="text-align:right;">Actions</div>
      `;
      listContainer.appendChild(header);

      for (const art of ARTICLES) {
        const div = document.createElement("div");
        div.className = "article-item";

        // Image
        let thumb;
        if (art.imageUrl) {
          thumb = document.createElement("img");
          thumb.className = "thumb-mini";
          thumb.src = art.imageUrl;
          thumb.alt = art.title || "Illustration";
          thumb.loading = "lazy";
        } else {
          thumb = document.createElement("div");
          thumb.className = "thumb-mini placeholder";
          thumb.textContent = "Aucune image";
        }
        div.appendChild(thumb);

        // Titre
        const title = document.createElement("div");
        title.className = "article-item-title";
        title.textContent = art.title || "(sans titre)";
        div.appendChild(title);

        // Slug + cat√©gorie
        const meta = document.createElement("div");
        meta.className = "article-item-meta";

        const slugChip = document.createElement("span");
        slugChip.className = "chip";
        slugChip.innerHTML =
          "<strong>Slug</strong>" + (art.slug || "‚Äî");

        const catChip = document.createElement("span");
        catChip.className = "chip";
        catChip.innerHTML =
          "<strong>Cat.</strong>" + (art.category || "non d√©finie");

        meta.appendChild(slugChip);
        meta.appendChild(catChip);
        div.appendChild(meta);

        // Actions
        const actions = document.createElement("div");
        actions.className = "actions";

        const editBtn = document.createElement("button");
        editBtn.type = "button";
        editBtn.className = "btn-sm edit";
        editBtn.textContent = "Modifier";
        editBtn.addEventListener("click", () => {
          if (art.id == null) {
            Swal.fire("Erreur", "Impossible de modifier : aucun identifiant (id) renvoy√© par l‚ÄôAPI.", "error");
            return;
          }
          openModal("edit", art);
        });

        const deleteBtn = document.createElement("button");
        deleteBtn.type = "button";
        deleteBtn.className = "btn-sm delete";
        deleteBtn.textContent = "Supprimer";
        deleteBtn.addEventListener("click", async () => {
          if (art.id == null) {
            Swal.fire("Erreur", "Impossible de supprimer : aucun identifiant (id) renvoy√© par l‚ÄôAPI.", "error");
            return;
          }

          Swal.fire({
            title: "Supprimer cet article ?",
            text: "Cette action est d√©finitive.",
            icon: "warning",
            showCancelButton: true,
            confirmButtonText: "Oui, supprimer",
            cancelButtonText: "Annuler"
          }).then(async (result) => {
            if (!result.isConfirmed) return;

            try {
              // üî¥ ICI CHANGEMENT : on passe l'id en query string, pas dans l'URL /3
              const res = await fetch("/api/articles?id=" + encodeURIComponent(art.id), {
                method: "DELETE",
              });
              if (!res.ok) {
                const data = await res.json().catch(() => ({}));
                throw new Error(data.error || "Erreur serveur");
              }
              ARTICLES = ARTICLES.filter(a => a.id !== art.id);
              renderArticles();
              Swal.fire("Supprim√©", "L‚Äôarticle a √©t√© supprim√©.", "success");
            } catch (err) {
              console.error(err);
              Swal.fire("Erreur", "Impossible de supprimer l‚Äôarticle.", "error");
            }
          });
        });

        actions.appendChild(editBtn);
        actions.appendChild(deleteBtn);
        div.appendChild(actions);

        listContainer.appendChild(div);
      }
    }

    function fileToDataUrl(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = (e) => reject(e);
        reader.readAsDataURL(file);
      });
    }

    articleForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      message.textContent = "";
      message.className = "";
      submitBtn.disabled = true;

      const title   = articleForm.title.value.trim();
      const slug    = articleForm.slug.value.trim();
      const summary = articleForm.summary.value.trim();
      const category = articleForm.category.value;
      const content = articleForm.content.value.trim();

      if (!title || !slug || !content) {
        message.textContent =
          "Merci de remplir au minimum le titre, le slug et le contenu.";
        message.classList.add("err");
        submitBtn.disabled = false;
        return;
      }

      let imageUrlToSave = currentImageUrl;

      // Si un fichier est s√©lectionn√©, on le convertit en Data URL
      const file = imageFileInput.files && imageFileInput.files[0];
      if (file) {
        try {
          imageUrlToSave = await fileToDataUrl(file);
        } catch (err) {
          console.error("Erreur lecture fichier image", err);
          Swal.fire("Erreur", "Impossible de lire l‚Äôimage s√©lectionn√©e.", "error");
          submitBtn.disabled = false;
          return;
        }
      }

      const payload = {
        title,
        slug,
        summary,
        category,
        imageUrl: imageUrlToSave,
        content,
      };

      try {
        let url = "/api/articles";
        let method = "POST";

        if (currentMode === "edit" && currentId != null) {
          // üî¥ ICI CHANGEMENT : on passe l'id en query string pour PUT aussi
          url = "/api/articles?id=" + encodeURIComponent(currentId);
          method = "PUT";
        }

        const res = await fetch(url, {
          method,
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });

        if (!res.ok) {
          const data = await res.json().catch(() => ({}));
          throw new Error(data.error || "Erreur serveur");
        }

        message.textContent =
          currentMode === "create"
            ? "Article enregistr√© avec succ√®s."
            : "Article modifi√© avec succ√®s.";
        message.classList.add("ok");

        await loadArticles();

        await Swal.fire(
          "Succ√®s",
          currentMode === "create"
            ? "L‚Äôarticle a √©t√© cr√©√© avec succ√®s."
            : "L‚Äôarticle a √©t√© mis √† jour avec succ√®s.",
          "success"
        );

        closeModal();
      } catch (err) {
        console.error(err);
        message.textContent =
          "Impossible d‚Äôenregistrer l‚Äôarticle. V√©rifiez votre connexion ou r√©essayez plus tard.";
        message.classList.add("err");
        Swal.fire(
          "Erreur",
          "Impossible d‚Äôenregistrer l‚Äôarticle. V√©rifiez votre connexion ou r√©essayez plus tard.",
          "error"
        );
      } finally {
        submitBtn.disabled = false;
      }
    });

    loadArticles();
  </script>
</body>
</html>
